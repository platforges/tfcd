name: Deploy Terraform
on:
  workflow_call:
    inputs:
      ref:
        description: The git ref to checkout
        type: string
        default: ''
      environment:
        required: true
        type: string
      hash:
        required: true
        type: string
      runs-on:
        type: string
        default: ubuntu-latest
    outputs:
      result:
        description: Whether terraform apply step was successfull or not
        value: ${{ jobs.deploy.outputs.result }}
permissions:
  id-token: write # configure-aws-credentials
jobs:
  deploy:
    runs-on: ${{ inputs.runs-on }}
    continue-on-error: true
    concurrency: deploy-${{ inputs.environment }}
    environment: ${{ inputs.environment }}
    outputs:
      result: ${{ steps.apply.outputs.result }}
    steps:
    - id: apply
      run: |
        echo "environment: ${{ inputs.environment }}"
        echo "ref: ${{ inputs.ref }}"
        echo "hash: ${{ inputs.hash }}"
        echo "result=success" >> $GITHUB_OUTPUT
