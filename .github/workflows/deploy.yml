name: Deploy Terraform
on:
  workflow_call:
    inputs:
      environment:
        type: string
        required: true
      ref:
        type: string
        default: ''
      runs-on:
        type: string
        default: ubuntu-latest
      skip:
        type: boolean
        default: false
      fail:
        type: boolean
        default: false
      sleep:
        type: number
        default: 0
# permissions:
#   id-token: write # configure-aws-credentials
jobs:
  deploy:
    runs-on: ${{ inputs.runs-on }}
    concurrency: deploy-${{ inputs.environment }}
    # environment: ${{ inputs.environment }}
    if: ${{ !inputs.skip }}
    steps:
    - run: |
        echo "Running .github/workflows/deploy.yml ðŸš€"
        echo "environment: ${{ inputs.environment }}"
        if ${{ inputs.fail }}; then
          exit 1
        fi
        echo "Sleeping for ${{ inputs.sleep }}s"
        sleep ${{ inputs.sleep }}
        echo "Done ðŸŸ¢"
